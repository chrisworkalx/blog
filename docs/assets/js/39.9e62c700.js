(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{228:function(s,n,a){"use strict";a.r(n);var t=a(6),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"闭包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#闭包"}},[s._v("#")]),s._v(" 闭包")]),s._v(" "),a("blockquote",[a("p",[s._v("了解闭包前先来了解一下上级作用域和堆栈内存释放问题。")])]),s._v(" "),a("h2",{attrs:{id:"上级作用域的概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上级作用域的概念"}},[s._v("#")]),s._v(" 上级作用域的概念")]),s._v(" "),a("ul",[a("li",[s._v("函数的上级作用域在哪里创建创建的，上级作用域就是谁")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nvar a = 10\nfunction foo(){\n    console.log(a)\n}\n\nfunction sum() {\n    var a = 20\n    foo()\n}\n\nsum()\n/* 输出\n    10\n/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("函数 "),a("code",[s._v("foo()")]),s._v(" 是在全局下创建的，所以 "),a("code",[s._v("a")]),s._v(" 的上级作用域就是 "),a("code",[s._v("window")]),s._v("，输出就是 "),a("code",[s._v("10")])])])]),s._v(" "),a("h2",{attrs:{id:"思考题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思考题"}},[s._v("#")]),s._v(" 思考题")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nvar n = 10\nfunction fn(){\n    var n =20\n    function f() {\n       n++;\n       console.log(n)\n     }\n    f()\n    return f\n}\n\nvar x = fn()\nx()\nx()\nconsole.log(n)\n/* 输出\n*  21\n    22\n    23\n    10\n/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[a("strong",[s._v("稍微提个醒，单独的 n++ 和 ++n 表达式的结果是一样的")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("思路："),a("code",[s._v("fn")]),s._v(" 的返回值是什么变量 "),a("code",[s._v("x")]),s._v(" 就是什么，这里 "),a("code",[s._v("fn")]),s._v(" 的返回值是函数名 "),a("code",[s._v("f")]),s._v(" 也就是 "),a("code",[s._v("f")]),s._v(" 的堆内存地址，"),a("code",[s._v("x()")]),s._v(" 也就是执行的是函数 "),a("code",[s._v("f()")]),s._v("，而不是 "),a("code",[s._v("fn()")]),s._v("，输出的结果显而易见")])])]),s._v(" "),a("ul",[a("li",[s._v("关于如何查找上级作用域")])]),s._v(" "),a("blockquote",[a("p",[s._v("参考："),a("a",{attrs:{href:"https://juejin.cn/post/6933377315573497864",title:"https://juejin.cn/post/6933377315573497864",target:"_blank",rel:"noopener noreferrer"}},[s._v("彻底解决 JS 变量提升的面试题"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"js-堆栈内存释放"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js-堆栈内存释放"}},[s._v("#")]),s._v(" JS 堆栈内存释放")]),s._v(" "),a("ul",[a("li",[s._v("堆内存：存储引用类型值，对象类型就是键值对，函数就是代码字符串。")]),s._v(" "),a("li",[s._v("堆内存释放：将引用类型的空间地址变量赋值成 "),a("code",[s._v("null")]),s._v("，或没有变量占用堆内存了浏览器就会释放掉这个地址")]),s._v(" "),a("li",[s._v("栈内存：提供代码执行的环境和存储基本类型值。")]),s._v(" "),a("li",[s._v("栈内存释放：一般当函数执行完后函数的私有作用域就会被释放掉。")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("但栈内存的释放也有特殊情况：① 函数执行完，但是函数的私有作用域内有内容被栈外的变量还在使用的，栈内存就不能释放里面的基本值也就不会被释放。② 全局下的栈内存只有页面被关闭的时候才会被释放")])])]),s._v(" "),a("h2",{attrs:{id:"闭包是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#闭包是什么"}},[s._v("#")]),s._v(" 闭包是什么")]),s._v(" "),a("blockquote",[a("p",[s._v("在 JS 忍者秘籍(P90)中对闭包的定义：闭包允许函数访问并操作函数外部的变量。红宝书上对于闭包的定义：闭包是指有权访问另外一个函数作用域中的变量的函数。 MDN 对闭包的定义为：闭包是指那些能够访问自由变量的函数。这里的自由变量是外部函数作用域中的变量。")])]),s._v(" "),a("blockquote",[a("p",[s._v("概述上面的话，"),a("strong",[s._v("闭包是指有权访问另一个函数作用域中变量的函数")])])]),s._v(" "),a("h2",{attrs:{id:"形成闭包的原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#形成闭包的原因"}},[s._v("#")]),s._v(" 形成闭包的原因")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("内部的函数存在外部作用域的引用就会导致闭包")]),s._v("。从上面介绍的上级作用域的概念中其实就有闭包的例子 "),a("code",[s._v("return f")]),s._v("就是一个表现形式。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nvar a = 0\nfunction foo(){\n    var b =14\n    function fo(){\n        console.log(a, b)\n    }\n    fo()\n}\nfoo()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("blockquote",[a("p",[s._v("这里的子函数 "),a("code",[s._v("fo")]),s._v(" 内存就存在外部作用域的引用 "),a("code",[s._v("a, b")]),s._v("，所以这就会产生闭包")])]),s._v(" "),a("h2",{attrs:{id:"闭包变量存储的位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#闭包变量存储的位置"}},[s._v("#")]),s._v(" 闭包变量存储的位置")]),s._v(" "),a("blockquote",[a("p",[s._v("直接说明："),a("strong",[s._v("闭包中的变量存储的位置是堆内存。")])])]),s._v(" "),a("ul",[a("li",[s._v("假如闭包中的变量存储在栈内存中，那么栈的回收 会把处于栈顶的变量自动回收。所以闭包中的变量如果处于栈中那么变量被销毁后，闭包中的变量就没有了。所以闭包引用的变量是出于堆内存中的。")])]),s._v(" "),a("h2",{attrs:{id:"闭包的作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#闭包的作用"}},[s._v("#")]),s._v(" 闭包的作用")]),s._v(" "),a("ul",[a("li",[s._v("保护函数的私有变量不受外部的干扰。形成不销毁的栈内存。")]),s._v(" "),a("li",[s._v("保存，把一些函数内的值保存下来。闭包可以实现方法和属性的私有化")])]),s._v(" "),a("h2",{attrs:{id:"闭包经典使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#闭包经典使用场景"}},[s._v("#")]),s._v(" 闭包经典使用场景")]),s._v(" "),a("ul",[a("li",[a("ol",[a("li",[a("code",[s._v("return")]),s._v(" 回一个函数")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nvar n = 10\nfunction fn(){\n    var n =20\n    function f() {\n       n++;\n       console.log(n)\n     }\n    return f\n}\n\nvar x = fn()\nx() // 21\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("blockquote",[a("p",[s._v("这里的 return "),a("code",[s._v("f")]),s._v(", "),a("code",[s._v("f()")]),s._v("就是一个闭包，存在上级作用域的引用。")])]),s._v(" "),a("ul",[a("li",[a("ol",{attrs:{start:"2"}},[a("li",[s._v("函数作为参数")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nvar a = '林一一'\nfunction foo(){\n    var a = 'foo'\n    function fo(){\n        console.log(a)\n    }\n    return fo\n}\n\nfunction f(p){\n    var a = 'f'\n    p()\n}\nf(foo())\n/* 输出\n*   foo\n/ \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("blockquote",[a("p",[s._v("使用 return "),a("code",[s._v("fo")]),s._v(" 返回回来，"),a("code",[s._v("fo()")]),s._v(" 就是闭包，"),a("code",[s._v("f(foo())")]),s._v(" 执行的参数就是函数 "),a("code",[s._v("fo")]),s._v("，因为 "),a("code",[s._v("fo() 中的 a")]),s._v(" 的上级作用域就是函数"),a("code",[s._v("foo()")]),s._v("，所以输出就是"),a("code",[s._v("foo")])])]),s._v(" "),a("ul",[a("li",[a("ol",{attrs:{start:"3"}},[a("li",[s._v("IIFE（自执行函数）")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nvar n = '林一一';\n(function p(){\n    console.log(n)\n})()\n/* 输出\n*   林一一\n/ \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("blockquote",[a("p",[s._v("同样也是产生了闭包"),a("code",[s._v("p()")]),s._v("，存在 "),a("code",[s._v("window")]),s._v("下的引用 "),a("code",[s._v("n")]),s._v("。")])]),s._v(" "),a("ul",[a("li",[a("ol",{attrs:{start:"4"}},[a("li",[s._v("循环赋值")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nfor(var i = 0; i<10; i++){\n  (function(j){\n       setTimeout(function(){\n        console.log(j)\n    }, 1000) \n  })(i)\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("blockquote",[a("p",[s._v("因为存在闭包的原因上面能依次输出1~10，闭包形成了10个互不干扰的私有作用域。将外层的自执行函数去掉后就不存在外部作用域的引用了，输出的结果就是连续的 10。为什么会连续输出10，因为 JS 是单线程的遇到异步的代码不会先执行(会入栈)，等到同步的代码执行完 "),a("code",[s._v("i++")]),s._v(" 到 10时，异步代码才开始执行此时的 "),a("code",[s._v("i=10")]),s._v(" 输出的都是 10。")])]),s._v(" "),a("ul",[a("li",[a("ol",{attrs:{start:"5"}},[a("li",[s._v("使用回调函数就是在使用闭包")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nwindow.name = '林一一'\nsetTimeout(function timeHandler(){\n  console.log(window.name);\n}, 100)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[a("ol",{attrs:{start:"6"}},[a("li",[s._v("节流防抖")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\n// 节流\nfunction throttle(fn, timeout) {\n    let timer = null\n    return function (...arg) {\n        if(timer) return\n        timer = setTimeout(() => {\n            fn.apply(this, arg)\n            timer = null\n        }, timeout)\n    }\n}\n\n// 防抖\nfunction debounce(fn, timeout){\n    let timer = null\n    return function(...arg){\n        clearTimeout(timer)\n        timer = setTimeout(() => {\n            fn.apply(this, arg)\n        }, timeout)\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("ul",[a("li",[a("ol",{attrs:{start:"7"}},[a("li",[s._v("柯里化实现")])])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nfunction curry(fn, len = fn.length) {\n    return _curry(fn, len)\n}\n\nfunction _curry(fn, len, ...arg) {\n    return function (...params) {\n        let _arg = [...arg, ...params]\n        if (_arg.length >= len) {\n            return fn.apply(this, _arg)\n        } else {\n            return _curry.call(this, fn, len, ..._arg)\n        }\n    }\n}\n\nlet fn = curry(function (a, b, c, d, e) {\n    console.log(a + b + c + d + e)\n})\n\nfn(1, 2, 3, 4, 5)  // 15\nfn(1, 2)(3, 4, 5)\nfn(1, 2)(3)(4)(5)\nfn(1)(2)(3)(4)(5)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("h2",{attrs:{id:"使用闭包需要注意什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用闭包需要注意什么"}},[s._v("#")]),s._v(" 使用闭包需要注意什么")]),s._v(" "),a("blockquote",[a("p",[s._v("容易导致内存泄漏。闭包会携带包含其它的函数作用域，因此会比其他函数占用更多的内存。过度使用闭包会导致内存占用过多，所以要谨慎使用闭包。")])]),s._v(" "),a("h2",{attrs:{id:"怎么检查内存泄露"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#怎么检查内存泄露"}},[s._v("#")]),s._v(" 怎么检查内存泄露")]),s._v(" "),a("ul",[a("li",[s._v("performance 面板 和 memory 面板可以找到泄露的现象和位置")])]),s._v(" "),a("p",[s._v("详细可以查看："),a("a",{attrs:{href:"https://juejin.cn/post/6844904048961781774#comment",title:"https://juejin.cn/post/6844904048961781774#comment",target:"_blank",rel:"noopener noreferrer"}},[s._v("js 内存泄漏场景、如何监控以及分析"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"经典面试题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#经典面试题"}},[s._v("#")]),s._v(" 经典面试题")]),s._v(" "),a("ul",[a("li",[s._v("for 循环和闭包(号称必刷题)")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nvar data = [];\n\nfor (var i = 0; i < 3; i++) {\n  data[i] = function () {\n    console.log(i);\n  };\n}\n\ndata[0]();\ndata[1]();\ndata[2]()\n/* 输出\n    3\n    3\n    3\n/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("blockquote",[a("p",[s._v("这里的 "),a("code",[s._v("i")]),s._v(" 是全局下的 "),a("code",[s._v("i")]),s._v("，共用一个作用域，当函数被执行的时候这时的 "),a("code",[s._v("i=3")]),s._v("，导致输出的结构都是3。")])]),s._v(" "),a("ul",[a("li",[s._v("使用闭包改善上面的写法达到预期效果，写法1：自执行函数和闭包")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nvar data = [];\n\nfor (var i = 0; i < 3; i++) {\n    (function(j){\n      setTimeout( data[j] = function () {\n        console.log(j);\n      }, 0)\n    })(i)\n}\n\ndata[0]();\ndata[1]();\ndata[2]()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("ul",[a("li",[s._v("写法2：使用 "),a("code",[s._v("let")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nvar data = [];\n\nfor (let i = 0; i < 3; i++) {\n  data[i] = function () {\n    console.log(i);\n  };\n}\n\ndata[0]();\ndata[1]();\ndata[2]()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("blockquote",[a("p",[a("code",[s._v("let")]),s._v(" 具有块级作用域，形成的3个私有作用域都是互不干扰的。")])]),s._v(" "),a("p",[a("strong",[s._v("思考题和上面有何不同 (字节)")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("js\n复制代码\nvar result = [];\nvar a = 3;\nvar total = 0;\n\nfunction foo(a) {\n    for (var i = 0; i < 3; i++) {\n        result[i] = function () {\n            total += i * a;\n            console.log(total);\n        }\n    }\n}\n\nfoo(1);\nresult[0]();  // 3\nresult[1]();  // 6\nresult[2]();  // 9\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("blockquote",[a("p",[s._v("tip：这里也形成了闭包。total 被外层引用没有被销毁。")])])])}),[],!1,null,null,null);n.default=e.exports}}]);