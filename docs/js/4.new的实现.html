<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js基础面试new实现 | chrisworkalx的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/vueExpress_static/superhuman.jpg">
    <meta name="description" content="用心记录每一天的生活">
    
    <link rel="preload" href="/vueExpress_static/assets/css/0.styles.e5b55131.css" as="style"><link rel="preload" href="/vueExpress_static/assets/js/app.4e7810f7.js" as="script"><link rel="preload" href="/vueExpress_static/assets/js/2.13686704.js" as="script"><link rel="preload" href="/vueExpress_static/assets/js/11.99180abf.js" as="script"><link rel="prefetch" href="/vueExpress_static/assets/js/10.c17b2a42.js"><link rel="prefetch" href="/vueExpress_static/assets/js/12.4fa01bc1.js"><link rel="prefetch" href="/vueExpress_static/assets/js/13.6a0ea54c.js"><link rel="prefetch" href="/vueExpress_static/assets/js/14.4eb80a7e.js"><link rel="prefetch" href="/vueExpress_static/assets/js/15.a1e0d354.js"><link rel="prefetch" href="/vueExpress_static/assets/js/16.8eb52d8b.js"><link rel="prefetch" href="/vueExpress_static/assets/js/17.3b70ee0a.js"><link rel="prefetch" href="/vueExpress_static/assets/js/18.8d307589.js"><link rel="prefetch" href="/vueExpress_static/assets/js/19.eaf203f7.js"><link rel="prefetch" href="/vueExpress_static/assets/js/20.c0ca02a7.js"><link rel="prefetch" href="/vueExpress_static/assets/js/3.a4919ea9.js"><link rel="prefetch" href="/vueExpress_static/assets/js/4.dc321bd9.js"><link rel="prefetch" href="/vueExpress_static/assets/js/5.391be865.js"><link rel="prefetch" href="/vueExpress_static/assets/js/6.ad7e2c0f.js"><link rel="prefetch" href="/vueExpress_static/assets/js/7.a0c5e9bb.js"><link rel="prefetch" href="/vueExpress_static/assets/js/8.4c650fb4.js"><link rel="prefetch" href="/vueExpress_static/assets/js/9.71db32c8.js">
    <link rel="stylesheet" href="/vueExpress_static/assets/css/0.styles.e5b55131.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vueExpress_static/" class="home-link router-link-active"><!----> <span class="site-name">chrisworkalx的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vueExpress_static/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vueExpress_static/vueFolder/vue2/介绍.html" class="nav-link">
  vue2
</a></li><li class="dropdown-item"><!----> <a href="/vueExpress_static/vueFolder/vue3/介绍.html" class="nav-link">
  vue3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vueExpress_static/reactFolder/react_class_before_16.3/1.介绍.html" class="nav-link">
  react_16.3
</a></li><li class="dropdown-item"><!----> <a href="/vueExpress_static/reactFolder/react_hooks/1.介绍.html" class="nav-link">
  react_hooks
</a></li></ul></div></div><div class="nav-item"><a href="/vueExpress_static/js/1.介绍.html" class="nav-link">
  js
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vueExpress_static/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vueExpress_static/vueFolder/vue2/介绍.html" class="nav-link">
  vue2
</a></li><li class="dropdown-item"><!----> <a href="/vueExpress_static/vueFolder/vue3/介绍.html" class="nav-link">
  vue3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow down"></span></button> <button type="button" aria-label="React" class="mobile-dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vueExpress_static/reactFolder/react_class_before_16.3/1.介绍.html" class="nav-link">
  react_16.3
</a></li><li class="dropdown-item"><!----> <a href="/vueExpress_static/reactFolder/react_hooks/1.介绍.html" class="nav-link">
  react_hooks
</a></li></ul></div></div><div class="nav-item"><a href="/vueExpress_static/js/1.介绍.html" class="nav-link">
  js
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vueExpress_static/js/1.介绍.html" class="sidebar-link">介绍</a></li><li><a href="/vueExpress_static/js/2.继承.html" class="sidebar-link">继承（一）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vueExpress_static/js/2.继承.html#什么是js继承" class="sidebar-link">什么是js继承？</a></li><li class="sidebar-sub-header"><a href="/vueExpress_static/js/2.继承.html#继承方式有哪些" class="sidebar-link">继承方式有哪些？</a></li><li class="sidebar-sub-header"><a href="/vueExpress_static/js/2.继承.html#_1-原型链继承" class="sidebar-link">1.原型链继承</a></li><li class="sidebar-sub-header"><a href="/vueExpress_static/js/2.继承.html#_1-1-原型链继承2" class="sidebar-link">1.1 原型链继承2</a></li><li class="sidebar-sub-header"><a href="/vueExpress_static/js/2.继承.html#_2-构造函数继承" class="sidebar-link">2. 构造函数继承</a></li><li class="sidebar-sub-header"><a href="/vueExpress_static/js/2.继承.html#_3-组合继承" class="sidebar-link">3. 组合继承</a></li></ul></li><li><a href="/vueExpress_static/js/3.继承..html" class="sidebar-link">继承（二）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vueExpress_static/js/3.继承..html#_4-原型式继承" class="sidebar-link">4. 原型式继承</a></li><li class="sidebar-sub-header"><a href="/vueExpress_static/js/3.继承..html#_5-寄生式继承" class="sidebar-link">5. 寄生式继承</a></li></ul></li><li><a href="/vueExpress_static/js/4.new的实现.html" class="active sidebar-link">js基础面试new实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vueExpress_static/js/4.new的实现.html#举个例子" class="sidebar-link">举个例子</a></li><li class="sidebar-sub-header"><a href="/vueExpress_static/js/4.new的实现.html#实现方法" class="sidebar-link">实现方法</a></li><li class="sidebar-sub-header"><a href="/vueExpress_static/js/4.new的实现.html#原生new带返回值" class="sidebar-link">原生new带返回值</a></li><li class="sidebar-sub-header"><a href="/vueExpress_static/js/4.new的实现.html#最终优化版本" class="sidebar-link">最终优化版本</a></li></ul></li><li><a href="/vueExpress_static/js/5.手写Promise.html" class="sidebar-link">mini-Promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vueExpress_static/js/5.手写Promise.html#原生promise使用" class="sidebar-link">原生Promise使用</a></li><li class="sidebar-sub-header"><a href="/vueExpress_static/js/5.手写Promise.html#开始封装" class="sidebar-link">开始封装</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js基础面试new实现"><a href="#js基础面试new实现" class="header-anchor">#</a> js基础面试new实现</h1> <blockquote><p>我们都知道js通过new这个关键字可以为构造函创建实例对象，那这其中内部实现机制都有哪些呢？</p></blockquote> <h2 id="举个例子"><a href="#举个例子" class="header-anchor">#</a> 举个例子</h2> <div class="language-js new 操作案例 extra-class"><pre class="language-js"><code><span class="token operator">-</span> 在es6还没有<span class="token keyword">class</span>这个语法糖的时候，我们创建一个构造函数都是下面这个样子
    <span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'hello, my name is'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
 <span class="token operator">-</span> 当我们去创建一个Person构造的实例时可以像下面这样
    <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'小明'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'小红'</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    p<span class="token punctuation">.</span>name <span class="token comment">// 小明</span>
    p2<span class="token punctuation">.</span>name <span class="token comment">// 小红</span>
    
    p<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//hello, my name is 小明</span>
    p2<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//hello, my name is 小红</span>
    
    从这个例子中，我们可以看到，实例 p、p2 可以：
    <span class="token number">1.</span>  访问到 Person 构造函数里的属性
    <span class="token number">2.</span>  访问到 <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype 中的属性
</code></pre></div><ul><li>为了进一步探索这中间到底发生了什么，我们把代码直接拷贝到浏览器看下效果
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/38080d8751c242a1bd3b0e72d0a7a002~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></li></ul> <blockquote><ol><li>实例p上[[prototype]] （也叫__proto__隐示原型）和 构造函数的prototype相同；也就是说实例对象可以调用构造函数的原型方法</li> <li>另外发现p.__proto__.constructor === Person // true</li> <li>那么是不是得到p.__proto__ === Person.prototype //true</li></ol></blockquote> <h2 id="实现方法"><a href="#实现方法" class="header-anchor">#</a> 实现方法</h2> <ul><li>按照上面这个思路上代码</li></ul> <div class="language-js 实现new 模板1 extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">CreateNewConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">//创建一个控对象</span>
    <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    
    <span class="token comment">//截取构造函数</span>

    Constructor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//将实例的隐示原型指向构造函数的原型对象</span>

    obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token class-name">Constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
    
    <span class="token comment">//构造函数执行并改变this指向obj</span>

    <span class="token function">Constructor</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//返回实例对象</span>

    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><blockquote><p><strong>验证</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token function">CreateNewConstructor</span><span class="token punctuation">(</span>Person<span class="token punctuation">,</span> <span class="token string">'小刚'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p3<span class="token punctuation">.</span>name <span class="token comment">// 小刚</span>
p3<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//hello, my name is 小刚</span>
</code></pre></div></blockquote> <h2 id="原生new带返回值"><a href="#原生new带返回值" class="header-anchor">#</a> 原生new带返回值</h2> <div class="language-js new返回值测试 extra-class"><pre class="language-js"><code><span class="token number">1.</span> 改造返回值对象
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> hobby</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        hobby
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 
 <span class="token keyword">const</span> p4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'小李'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'football'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 p4<span class="token punctuation">.</span>name <span class="token comment">// undefined</span>
 p4<span class="token punctuation">.</span>age <span class="token comment">// undefined;</span>
 
 p4<span class="token punctuation">.</span>hobby <span class="token comment">// football</span>
 
 
<span class="token number">2.</span> 返回值是常规数据类型
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> hobby</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">'hello,js'</span>
 <span class="token punctuation">}</span>
 
 <span class="token keyword">const</span> p5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'小王'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'basketball'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 p5<span class="token punctuation">.</span>name <span class="token comment">// 小王</span>
 p5<span class="token punctuation">.</span>age <span class="token comment">// 21;</span>
 p5<span class="token punctuation">.</span>hobby <span class="token comment">//undefined</span>
 
</code></pre></div><blockquote><p>结论总结</p> <ol><li>构造函数返回了一个对象，在实例中只能访问返回的对象中的属性。</li> <li>如果没有返回值或者返回值是基本数据类型那么直接返回这个实例对象就好了</li></ol></blockquote> <h2 id="最终优化版本"><a href="#最终优化版本" class="header-anchor">#</a> 最终优化版本</h2> <div class="language-js 最终版本 extra-class"><pre class="language-js"><code>    <span class="token keyword">function</span> <span class="token function">CreateNewConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//创建一个控对象</span>
        <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token comment">//截取构造函数</span>

        Constructor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//将实例的隐示原型指向构造函数的原型对象</span>

        obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token class-name">Constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>

        <span class="token comment">//构造函数执行并改变this指向obj,并且用一个变量接收这个返回值结果</span>

        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">Constructor</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//最终处理返回值</span>
       
        <span class="token keyword">return</span> <span class="token keyword">typeof</span> res <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">?</span> res <span class="token operator">:</span> obj<span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>最后欢迎大家留言交流</strong></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">5/14/2023, 5:27:24 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vueExpress_static/js/3.继承..html" class="prev">
        继承（二）
      </a></span> <span class="next"><a href="/vueExpress_static/js/5.手写Promise.html">
        mini-Promise
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vueExpress_static/assets/js/app.4e7810f7.js" defer></script><script src="/vueExpress_static/assets/js/2.13686704.js" defer></script><script src="/vueExpress_static/assets/js/11.99180abf.js" defer></script>
  </body>
</html>
